var niAC,AddressConfiguration=function(){},_isJQ=!!window.jQuery,_window=$(window),_checkInstance=function(){$.addressConfiguration.instance||(niAC=new AddressConfiguration,niAC.init(),$.addressConfiguration.instance=niAC)};AddressConfiguration.prototype={constructor:AddressConfiguration,init:function(){},addAddress:function(n,t){n.find(t.inputSelector).prop("disabled",!0);n.find(t.freeInputSelector).prop("disabled",!1);var i=n.find(t.countriesInput);niAC._attachCountryHandlers(n,t);niAC._attachCityHandlers(n,t);niAC._attachProvinceHandlers(n,t);i.prop("disabled",!1);niAC._enableCityInput(n,t);niAC._enableProvinceInput(n,t);niAC._checkCountryOption(n,t)&&i.trigger("change")},reset:function(n,t,i){var f=n.find(t.countriesInput),e=f.find("option").filter(function(){return $(this).attr("value")<=0}),r,u;e.prop("disabled",!1);f.val(e.attr("value"));niAC._detachCountryHandlers(n,t);niAC._detachCityHandlers(n,t);niAC._detachProvinceHandlers(n,t);i&&(r=n.find(t.citiesInput),u=n.find(t.provincesInput),t.getProvinces.before&&t.getProvinces.before(u),u=niAC._updateInput(n,t.provinceId,t.provincesInput,i.provinceId,i.province),t.getProvinces.after&&t.getProvinces.after(u),t.getCities.before&&t.getCities.before(r),r=niAC._updateInput(n,t.cityId,t.citiesInput,i.cityId,i.city),t.getCities.after&&t.getCities.after(r),f.val(i.countryId));niAC.addAddress(n,t)},_updateInput:function(n,t,i,r,u){var f=n.find(i),c=n.find(t),h,s,o,e;if(c.val(r),h=parseInt(r),h>0){if(f.is("select"))$(i+" option[value='"+r+"']").length>0?f.val(r):(s=new Option(u,r,!0,!0),f.append(s));else{for(o="<select ",e=0;e<f[0].attributes.length;e++)o+=f[0].attributes[e].name+'="'+f[0].attributes[e].value+'" ';o+="><\/select>";f.replaceWith(o);f=n.find(i);s=new Option(u,r,!0,!0);f.append(s)}f.val(r)}else if(h<=0){for(o='<input type="text" ',e=0;e<f[0].attributes.length;e++)o+=f[0].attributes[e].name+'="'+f[0].attributes[e].value+'" ';o+="/>";f.replaceWith(o);f=n.find(i);f.val(u)}return f},_baseCountryChangeHandler:function(n){n.data.el.find(n.data.options.countriesInput).find("option").filter(function(){return $(this).attr("value")<=0}).prop("disabled",!0);niAC._enableCityInput(n.data.el,n.data.options)},_baseCityChangeHandler:function(n){niAC._enableProvinceInput(n.data.el,n.data.options)},_baseProvinceChangeHandler:function(){},_attachCountryHandlers:function(n,t){var i=n.find(t.countriesInput);if(t.useDefaultCountryChangeHandler)i.on("change",{el:n,options:t},niAC._baseCountryChangeHandler);if(t.onChangeCountry)i.on("change",t.onChangeCountry)},_attachCityHandlers:function(n,t){var i=n.find(t.citiesInput);if(i.is("select"))i.on("change",function(){n.find(t.cityId).val(i.val())});if(t.useDefaultCityChangeHandler)i.on("change",{el:n,options:t},niAC._baseCityChangeHandler);if(t.onChangeCity)i.on("change",t.onChangeCity)},_attachProvinceHandlers:function(n,t){var i=n.find(t.provincesInput);if(i.is("select"))i.on("change",function(){n.find(t.provinceId).val(i.val())});if(t.useDefaultProvinceChangeHandler)i.on("change",{el:n,options:t},niAC._baseProvinceChangeHandler);if(t.onChangeProvince)i.on("change",t.onChangeProvince)},_detachCountryHandlers:function(n,t){var i=n.find(t.countriesInput);t.useDefaultCountryChangeHandler&&i.off("change",niAC._baseCountryChangeHandler);t.onChangeCountry&&i.off("change",t.onChangeCountry)},_detachCityHandlers:function(n,t){var i=n.find(t.citiesInput);t.useDefaultCityChangeHandler&&i.off("change",niAC._baseCityChangeHandler);t.onChangeCity&&i.off("change",t.onChangeCity)},_detachProvinceHandlers:function(n,t){var i=n.find(t.provincesInput);t.useDefaultProvinceChangeHandler&&i.off("change",niAC._baseProvinceChangeHandler);t.onChangeProvince&&i.off("change",t.onChangeProvince)},_checkCountryOption:function(n,t){var i=n.find(t.countriesInput);return i.val()&&i.val()>0?!0:!1},_enableCityInput:function(n,t){var f,i,r;if(!t.cityIsFreeText){if(this._checkCountryOption(n,t)){var e=n.find(t.countriesInput).val(),o=t.isBilling(),s=n.find(t.cityId).val(),u=!0;t.getCities.shouldLoad&&(u=t.getCities.shouldLoad(n,t));u?(f={CountryId:e,CityId:s,IsBillingAddress:o},$.post(t.getCities.url,{viewmodel:f,__RequestVerificationToken:t.token}).done(function(i){var r,o,s,f,h,e,u;if(i.Success){if(r=n.find(t.citiesInput),o=r.val(),r.is("select")&&(o=""),o=o.toLowerCase(),niAC._detachCityHandlers(n,t),t.getCities.before&&t.getCities.before(r),i.Cities&&i.Cities.length>0){if(r.is(":hidden")==!1){for(e="<select ",u=0;u<r[0].attributes.length;u++)e+=r[0].attributes[u].name+'="'+r[0].attributes[u].value+'" ';for(e+="><\/select>",r.replaceWith(e),r=n.find(t.citiesInput),s=n.find(t.cityId).val(),f=0;f<i.Cities.length;f++)h=new Option(i.Cities[f].Text,i.Cities[f].Value,!!i.Cities[f].DefaultSelected,!!i.Cities[f].Selected||s==0&&o.length>0&&o==i.Cities[f].Text.toLowerCase()||i.Cities[f].Value==s),r.append(h)}}else{for(e='<input type="text" ',u=0;u<r[0].attributes.length;u++)e+=r[0].attributes[u].name+'="'+r[0].attributes[u].value+'" ';e+="/>";r.replaceWith(e);r=n.find(t.citiesInput);r.val(o);n.find(t.cityId).val("0")}t.getCities.after&&t.getCities.after(r);niAC._attachCityHandlers(n,t);niAC._enableAllCity(n,t,!0);r.trigger("change")}}).fail(function(){}).always(function(){})):(i=n.find(t.citiesInput),r=i.val(),i.is("select")&&(r=""),r=r.toLowerCase(),niAC._detachCityHandlers(n,t),t.getCities.before&&t.getCities.before(i),t.getCities.after&&t.getCities.after(i),niAC._attachCityHandlers(n,t),niAC._enableAllCity(n,t,!0),i.trigger("change"))}}else this._enableAllCity(n,t,!0)},_enableAllCity:function(n,t,i){n.find(t.citiesInput).prop("disabled",!!!i);n.find(t.withCitySelector).prop("disabled",!!!i)},_enableProvinceInput:function(n,t){var i,f,u,h,o,e,c;if(!t.provinceIsFreeText){var r=0,s="",u=n.find(t.citiesInput);if(u.is("select")?r=u.val():s=u.val(),r||(r=n.find(t.cityId).val()),r||(r=0),t.getProvinces.cityIsRequired&&r==0&&s==""){if(i=n.find(t.provincesInput),f=i.val(),i.is("select")&&(f=""),f=f.toLowerCase(),niAC._detachProvinceHandlers(n,t),t.getProvinces.before&&t.getProvinces.before(i),u=n.find(t.citiesInput),h=!!t.cityIsFreeText||!u.is("select"),h&&i.is("select")){for(o='<input type="text" ',e=0;e<i[0].attributes.length;e++)o+=i[0].attributes[e].name+'="'+i[0].attributes[e].value+'" ';o+="/>";i.replaceWith(o);i=n.find(t.provincesInput);i.val(f);n.find(t.provinceId).val("0")}t.getProvinces.after&&t.getProvinces.after(i);niAC._attachProvinceHandlers(n,t);niAC._enableAllProvince(n,t,h);i.trigger("change")}else c={CountryId:n.find(t.countriesInput).val(),CityId:r,CityName:s,IsBillingAddress:t.isBilling()},$.post(t.getProvinces.url,{viewmodel:c,__RequestVerificationToken:t.token}).done(function(i){var r,o,s,f,h,e,u;if(i.Success){if(r=n.find(t.provincesInput),o=r.val(),r.is("select")&&(o=""),o=o.toLowerCase(),niAC._detachProvinceHandlers(n,t),t.getProvinces.before&&t.getProvinces.before(r),i.Provinces&&i.Provinces.length>0){if(r.is(":hidden")==!1){for(e="<select ",u=0;u<r[0].attributes.length;u++)e+=r[0].attributes[u].name+'="'+r[0].attributes[u].value+'" ';for(e+="><\/select>",r.replaceWith(e),r=n.find(t.provincesInput),s=n.find(t.provinceId),f=0;f<i.Provinces.length;f++)h=new Option(i.Provinces[f].Text,i.Provinces[f].Value,!!i.Provinces[f].DefaultSelected,!!i.Provinces[f].Selected||s==0&&o.length>0&&o==i.Provinces[f].Text.toLowerCase()||i.Provinces[f].Value==s),r.append(h)}}else{for(e='<input type="text" ',u=0;u<r[0].attributes.length;u++)e+=r[0].attributes[u].name+'="'+r[0].attributes[u].value+'" ';e+="/>";r.replaceWith(e);r=n.find(t.provincesInput);r.val(o);n.find(t.provinceId).val("0")}t.getProvinces.after&&t.getProvinces.after(r);niAC._attachProvinceHandlers(n,t);niAC._enableAllProvince(n,t,!0);r.trigger("change")}}).fail(function(){}).always(function(){})}else this._enableAllProvince(n,t,!0)},_enableAllProvince:function(n,t,i){n.find(t.provincesInput).prop("disabled",!!!i);n.find(t.withProvinceSelector).prop("disabled",!!!i)}};$.addressConfiguration={instance:null,proto:AddressConfiguration.prototype,defaults:{countriesInput:"",citiesInput:"",cityId:"",provincesInput:"",provinceId:"",inputSelector:".address-input",countryIsFreeText:!1,cityIsFreeText:!1,provinceIsFreeText:!1,freeInputSelector:".free-text",withCitySelector:".configure-with-city",withProvinceSelector:".configure-with-province",useDefaultCountryChangeHandler:!0,useDefaultCityChangeHandler:!0,useDefaultProvinceChangeHandler:!0,cityCommandsProvince:!0,isBilling:function(){return!1}}};$.fn.addressConfiguration=function(n){_checkInstance();var t=$(this);if(n=$.extend(!0,{},$.addressConfiguration.defaults,n),n.token=t.closest("form").find("input[name='__RequestVerificationToken']").val(),!n.token){console.error("RequestVerificationToken is required.");return}if(!n.getCities.url){console.error("Url to get cities is required.");return}if(!n.getProvinces.url){console.error("Url to get provinces is required.");return}return t.attr("niac-options",JSON.stringify(n)),niAC.addAddress(t,n),t};$.fn.resetAddress=function(n,t){_checkInstance();var i=$(this),r={};if(i.attr("niac-options")&&(r=JSON.parse(i.attr("niac-options"))),n=$.extend(!0,{},$.addressConfiguration.defaults,r,n),n.token=i.closest("form").find("input[name='__RequestVerificationToken']").val(),!n.token){console.error("RequestVerificationToken is required.");return}if(!n.getCities.url){console.error("Url to get cities is required.");return}if(!n.getProvinces.url){console.error("Url to get provinces is required.");return}return i.attr("niac-options",JSON.stringify(n)),niAC.reset(i,n,t),i};