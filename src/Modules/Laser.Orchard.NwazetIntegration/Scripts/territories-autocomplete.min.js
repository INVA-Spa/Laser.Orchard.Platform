(function(n){var t=function(t,i,r){var o=n("ul.territories",t),f=t.data("name-prefix"),u;f!=""&&(f=f+".");u=t.data("id-prefix");u!=""&&(u=u+"_");var e=n("li",o).length,c=i.value,s=u+"Territories_"+e+"__IsChecked",l=f+"Territories["+e+"].IsChecked",a='<input type="checkbox" value="'+(r?'true" checked="checked"':"false")+' data-territory="'+i.label+'" data-territory-identity="'+i.label.toLowerCase()+'" id="'+s+'" name="'+l+'" />',v=a,h=n("<li>"+v+'<input type="hidden" value="'+c+'" id="'+u+"Territories_"+e+'__Id" name="'+f+"Territories["+e+'].Id" /><input type="hidden" value="'+i.label+'" id="'+u+"Territories_"+e+'__Name" name="'+f+"Territories["+e+'].Name" /><label class="forcheckbox" for="'+s+'">'+i.label+"<\/label><\/li>").hide();o.append(h);h.fadeIn()},i=function(i){var u,f;if(i!=null){var e=this.appendTo,r=e.parents("fieldset:first"),o=n("ul.tagit",r),s=n("ul.territories",r),h=n(".territories-editor",r).data("selected-territories");s.empty();u=o.tagit("tags");n(u).each(function(n,i){t(r,i,!0)});f=n.grep(h,function(t){return n.grep(u,function(n){return n.value===t.value}).length===0});n(f).each(function(n,t){createTerrritoryCheckbox(r,t,!1)})}},r=function(t,i){for(var f,r=i.label,u=0;u<i.depth;u++)r='<span class="gap">&nbsp;<\/span>'+r;return f="<li><\/li>",n(f).data("item.autocomplete",i).append(n("<a><\/a>").html(r)).appendTo(t)};n(".territories-editor").each(function(){var u=n(this).data("selected-territories"),f=n(this).data("autocomplete-url"),t=n("> ul",this).tagit({tagSource:function(t,i){var r=n(this.element).parents(".territories-editor");n.getJSON(f,{hierarchyId:r.data("hierarchy-id"),query:t.term},function(n){i(n)})},initialTags:u,triggerKeys:["enter","tab"],allowNewTags:!1,tagsChanged:i,caseSensitive:!1,minLength:2,sortable:!0}).data("ui-tagit");t.input.autocomplete().data("ui-autocomplete")._renderItem=r;t.input.autocomplete().on("autocompletefocus",function(n){n.preventDefault()})})})(jQuery);